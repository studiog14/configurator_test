<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FK Configurator - React Three Fiber</title>
    <link rel="icon" href="icons/favicon.png" type="image/jpeg" />
    <link rel="stylesheet" href="style.css" />
    
    <!-- 📱 DEVICE DETECTION -->
    <script>
        window.isMobile = /iPhone|iPad|iPod|Android|webOS|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        window.isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        window.isAndroid = /Android/i.test(navigator.userAgent);
        window.screenWidth = window.screen.width;
        window.isSmallScreen = window.screenWidth <= 768;
        
        console.log('🔍 Device detection:', {
            isMobile: window.isMobile,
            isIOS: window.isIOS,
            screenWidth: window.screenWidth
        });
        
        // 📱 ORIENTATION CHECK - poprawiona logika
        function checkOrientation() {
            const orientationWarning = document.getElementById('orientation-warning');
            const app = document.getElementById('app');
            const loader = document.getElementById('custom-loader');
            
            // Sprawdź czy to mobile/tablet
            if (window.isMobile || window.isSmallScreen) {
                // Sprawdź orientację
                const isPortrait = window.innerHeight > window.innerWidth;
                
                if (isPortrait) {
                    // Urządzenie w pionie - pokaż ostrzeżenie
                    if (orientationWarning) {
                        orientationWarning.style.display = 'flex';
                    }
                    if (app) {
                        app.style.display = 'none';
                    }
                    if (loader) {
                        loader.style.display = 'none';
                    }
                } else {
                    // Urządzenie w poziomie - ukryj ostrzeżenie
                    if (orientationWarning) {
                        orientationWarning.style.display = 'none';
                    }
                    if (app) {
                        app.style.display = 'flex';
                    }
                    // Loader będzie zarządzany przez główną logikę
                }
            } else {
                // Desktop - zawsze ukryj orientation warning
                if (orientationWarning) {
                    orientationWarning.style.display = 'none';
                }
                if (app) {
                    app.style.display = 'flex';
                }
            }
        }
        
        // Sprawdź orientację przy ładowaniu i przy obrocie
        document.addEventListener('DOMContentLoaded', checkOrientation);
        window.addEventListener('orientationchange', () => {
            setTimeout(checkOrientation, 100); // Małe opóźnienie na zmianę orientacji
        });
        window.addEventListener('resize', checkOrientation);
    </script>
    
    <!-- 🎬 REACT THREE FIBER + DREI IMPORTS - ESM.SH z dokładnymi wersjami -->
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom": "https://esm.sh/react-dom@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "three": "https://esm.sh/three@0.156.1",
        "@react-three/fiber": "https://esm.sh/@react-three/fiber@8.14.5?external=react,react-dom,three",
        "@react-three/drei": "https://esm.sh/@react-three/drei@9.85.0?external=react,react-dom,three,@react-three/fiber"
      }
    }
    </script>
</head>
<body>
    <!-- 📱 ORIENTATION WARNING - dla mobile w pionie -->
    <div id="orientation-warning">
        <div class="rotate-icon">📱</div>
        <h2>Obróć urządzenie</h2>
        <p>Konfigurator działa najlepiej w orientacji poziomej. Obróć swoje urządzenie, aby kontynuować.</p>
    </div>

    <!-- 🔄 ANIMATED LOADER -->
    <div id="custom-loader">
        <div class="logo-container" style="
            position: relative;
            margin-bottom: 40px;
            animation: logoPulse 3s ease-in-out infinite;
        ">
            <img src="icons/FK_logo.png" alt="Fajne Krzesła" style="
                max-width: 200px; 
                height: auto;
                border-radius: 10px;
                opacity: 0.9;
            " />
        </div>
        
        <div class="spinner" style="
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-top: 3px solid #333;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 30px;
        "></div>
        
        <div class="progress-container" style="
            width: 280px;
            height: 3px;
            background: #f0f0f0;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 25px;
        ">
            <div class="progress-bar" style="
                width: 100%;
                height: 100%;
                background: #FFD700;
                animation: progressSlide 2s ease-in-out infinite;
            "></div>
        </div>
        
        <div class="loading-text" style="
            font-size: 16px; 
            color: #333;
            font-weight: 500;
            text-align: center;
            letter-spacing: 0.5px;
        ">Inicjalizacja React Three Fiber...</div>
    </div>

    <div id="app">
        <!-- 🖥️ CANVAS -->
        <div id="canvas">
            <!-- React Three Fiber scene będzie tutaj -->
        </div>
        
        <!-- 🎯 WELCOME SCREEN -->
        <div id="welcome-screen">
            <img id="welcome-logo" src="icons/FK_logo.png" alt="Fajne Krzesła">
            <h1>Konfigurator Krzeseł</h1>
            <p>Wybierz model krzesła z dostępnych kategorii w bocznym panelu, aby rozpocząć konfigurację w 3D</p>
        </div>
        
        <!-- 📱 SIDEBAR -->
        <div id="sidebar">
            <!-- 🔍 SEARCH -->
            <div class="search-container">
                <input type="text" id="search-input" class="search-input" placeholder="Szukaj krzesła...">
            </div>
            
            <!-- 🏷️ CATEGORIES -->
            <div class="categories">
                <div class="category-grid">
                    <div class="category-btn" data-category="krzesla">
                        <div class="category-icon">
                            <img src="icons/chair_icon.png" alt="Krzesła" onerror="this.src='icons/placeholder.svg'">
                        </div>
                        <div class="category-label">Krzesła</div>
                    </div>
                    <div class="category-btn" data-category="hooker">
                        <div class="category-icon">
                            <img src="icons/legs_icon.png" alt="Hooker" onerror="this.src='icons/placeholder.svg'">
                        </div>
                        <div class="category-label">Hooker</div>
                    </div>
                    <div class="category-btn" data-category="biurowe">
                        <div class="category-icon">
                            <img src="icons/export_icon.png" alt="Biurowe" onerror="this.src='icons/placeholder.svg'">
                        </div>
                        <div class="category-label">Biurowe</div>
                    </div>
                    <div class="category-btn" data-category="ogrodowe">
                        <div class="category-icon">
                            <img src="icons/bulb_icon.png" alt="Ogrodowe" onerror="this.src='icons/placeholder.svg'">
                        </div>
                        <div class="category-label">Ogrodowe</div>
                    </div>
                </div>
            </div>
            
            <!-- 🪑 CHAIRS -->
            <div class="chairs-section">
                <div id="chairs-grid" class="chairs-grid">
                    <!-- Chairs will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- 🎬 LOAD CONFIGURATOR SCRIPT -->
    <script src="configurator.js" type="module"></script>
</body>
</html>
